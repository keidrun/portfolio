FROM node:14-alpine

ENV GATSBY_TELEMETRY_DISABLED 1

WORKDIR /app

# flow needs gcompat accoding to https://github.com/facebook/flow/issues/3649#issuecomment-886831975 and https://github.com/facebook/flow/issues/8846#issuecomment-1046616800
RUN apk update \
  && apk add --no-cache git ca-certificates \
  && apk add --no-cache gcompat libatomic

COPY package.json .
COPY yarn.lock .
RUN yarn install

COPY .flowconfig .
RUN yarn global add flow-typed \
  && flow-typed install

COPY . .

EXPOSE 8080

CMD yarn develop
